% vim: set tw=78 tabstop=4 shiftwidth=4 aw ai:

\chapter{Introduction}
\label{chapter:intro}

\textit{``Make it run, then make it right, then make it fast.'' -- Kent Beck}

Technology is strongly related to progress. As time goes, technology is the
prime ingredient for progress and progress forces technology to adapt itself,
to become better and more useful, to surpass its original design and provide
new outcomes.

Computer Science and Computer Engineering are among the most dynamic fields of
human knowledge with continuous transformation of the technology, principles
and scope it enables.

Among the myriad of inventions, discoveries and contributions to the
development of human civilization, the Internet stands out as one of the
most impressive and extraordinary. With only a few decades of existence, the
Internet has managed to provide the means for uniting the entire planet, for
ensuring access to knowledge, information and digital resources. The Internet
is also a catalyst for all major technological advances in many other fields
of study where researchers and engineers alike have been challenged to provide
better services, better connectivity, better user experience, better
performance and increased diversity.

On the frontier between two millennia, when the Internet had become a main
stream and de facto service, a new technology emerged, fulfilling the need for
data exchange among edge users: Peer-to-Peer Systems.

The exploding evolution of the Internet had provided users everywhere with
higher and higher bandwidth. The similarly explosive evolution of computer
technology ensured faster CPUs, larger hard disks, more memory. As even fringe
users had access to a good quality resources, the need to easily interconnect
and share information became preeminent. Peer-to-Peer Systems thus filled the
vacuum technological space enabled by the ever progressing Internet
technology.

Peer-to-Peer technology is as early as the Internet. In the beginnings of the
Internet, all stations had limited power and limited bandwidth and had to
cooperate to achieve a common goal. A prime example of this is the email
service. Peer-to-Peer have reemerged in late 90s when Napster became a true
powerful service in use by multiple users. Through more than 10 years of
research, engineering and updates, Peer-to-Peer concepts, applications and
protocols have managed to become common things nowadays.

As one of the most highly successful and most heavily used protocol in the
Internet, the BitTorrent protocol has captured the attention of research and
commercial entities alike. With a ``tit-for-tat'' algorithm at its base, the
BitTorrent protocol is nowadays the de facto protocol used for large file
distribution, offering advantages such as high speed, uniform bandwidth
consumption, low load on stations and extensibility.

The BitTorrent protocol is, in this thesis author's opinion, an example of a
protocol that had been made to work, and then has been made to work right.
Simple, yet powerful, BitTorrent shines when used for large content
distribution.

It is around the BitTorrent protocol that this thesis is centered around. Our
aim, as described in the thesis chapters is to take this protocol, run
measurements, analyze it and make it better: make it faster, enhance its
performance, its usability, broaden its scope. We do not aim to fill every
possible spot of improvement, but rather signal relevant aspects to be taken
into account to ensure increased performance.

\section{Thesis Objective}
\label{sec:intro:objective}

When involved in Peer-to-Peer systems, updates, enhancements and improvements
have to take into account the rules, diversity and particularities of such
systems. Carefully crafted experiments, sensible measurements, reasonable
conclusions, useful proposals are important components of research activities
in this domain.

The objective of this thesis is providing a series of improvements to
Peer-to-Peer systems at protocol level, either through updating and enhancing
existing protocols or designing and implementing new ones. Formal and
experimental evaluations are employed to provide arguments regarding the
advantages of these updates. Providing improvements is based on careful
trial deployment and analysis of Peer-to-Peer protocols. The use of testing
environments and the employment of measurements and evaluation techniques are
critical to the successful providing of protocol updates and improvements. As
a secondary objective, the thesis highlights the methods and mechanisms for
creating realistic, scalable and automated trial environments and the
approaches available for collecting, measuring and interpreting Peer-to-Peer
protocol parameters.

Providing proper evaluation of deployed trials information is critical to the
relevance of collected data. An important part of the thesis is dedicated to
evaluating architectures, protocols, actual implementations, internal
messages, network topologies with the help of versatile infrastructures.
Monitoring, log processing, internal processing are all employed to allow
in-depth view and analysis of P2P protocols.

As much of the work highlighted in this paper has been part of the
P2P-Next project, extensive focus has been given to using P2P technology for
providing content streaming. With BitTorrent at the focus of the research in
place, various adaptations and extensions have been analyzed. BitTorrent's
rarest-piece-first strategy is not suitable for streaming and adaptations to
the piece-picker policy have to be taken into account. The NextShare
technology, used in the P2P-Next project is the core of analysis and
measurements.

Measurements, evaluation and analysis were driven at providing better network
architectures and protocols for improved performance in P2P systems. A tracker
overlay that ensures swarm unification is a proposal for providing healthy
swarms and content unification. Providing a proper inter-tracker communication
protocol, marking relevant measurements and evaluation is part of the objective
of providing enhancements to existing solution. As is the kernel-based
implementation of a BitTorrent-alternative dubbed swift, designed from ground
up as a Transport-layer protocol.

\section{Thesis Scope}
\label{sec:intro:scope}

\todo{P2P, BitTorrent, motivation, run - collect - analyze - bring advice, low
level information, protocol messages, protocol improvements, comparison}

\section{Related Work}
\label{sec:intro:related}

% measurements and infrastructure

Most measurements and evaluations involving the BitTorrent protocol and
applications are either concerned with the behavior of a real-world swarm or
with the internal design of the protocol. There has been little focus on
creating a self-sustained swarm management environment capable of deploying
hundreds of controlled peers, and subsequently gathering results and
interpreting them.

The PlanetLab infrastructure provides a realistic testbed for
Peer-to-Peer experiments. PlanetLab nodes are connected to the Internet and
experiments have a more realistic testbed where delays, bandwidth and other
are subject to change. Tools are also available to aid in conducting
experiments and data collection.

Pouwelse~et~al.~\cite{measurement-study} have done extensive analysis on the
BitTorrent protocol using large real-world swarms focusing on the overall
performance and user satisfaction. Guo~et~al.~\cite{guo} have modeled the
BitTorrent protocol and provided a formal approach to the its functionality.
Bharambe~et~al.~\cite{bt-analysis} have done extensive studies on improving
BitTorrent's network performance.

Garbacki~et~al.~\cite{garbacki} have created a simulator for testing 2Fast, a
collaborative download protocol. The simulator is useful only for small swarms
that require control. Real-world experiments involved using real systems
communicating with real BitTorrent clients in the swarm.

A testing environment involving four major BitTorrent trackers for measuring
topology and path characteristics has been deployed by
Iosup~et~al.~\cite{corr-overlay}. They used nodes in PlanetLab. The
measurements were focused on geo-location and required access to a set of
nodes in PlanetLab. The authors' efforts are directed towards correlating
characteristics of BitTorrent and its Internet underlay, with focus on
topology, connectivity, and path-specific properties. For this purpose they
designed and implemented \textit{Multiprobe}, a framework for large-scale P2P
file sharing measurements. The main difference between their implementation
and our approach is that we focus on an in-depth client-level analysis and not
on the whole swarm.

Dragos~Ilie~et~al.~\cite{p2p-traf-meas} developed a measurement infrastructure
with the purpose of analyzing P2P traffic. The measurement methodology is
based on using application logging and link-layer packet capture.

Meulpolder~et~al.~\cite{p2p09} present a mathematical model for
bandwidth-inhomogeneous BitTorrent swarms. Based on a detailed analysis of
BitTorrent's unchoke policy for both seeders and leechers, they study the
dynamics of peers with different bandwidths, monitoring their unchoking and
uploading/downloading behavior. Their analysis showed that having only peers
with the same bandwidth is not enough to determine in-depth the peers'
behavior. In those experiments they split the peers into two bandwidth classes
- slow and fast - and they observed that slow ones usually unchoked other slow
peers, their data being transfered from fast peers. Although they do not offer
precise details about the experimental part of monitoring unchoking behavior
and transfers rates, their work relates to what we intend to do with the
logging messages that our system parses and stores. 

While Meulpolder~et~al.~\cite{p2p09} provides a peer level analysis, another
approach is to study BitTorrent at tracker level, as described by
Bardac~et~al.~\cite{tracker-mon}.  This paper implements a scalable and
extensible BitTorrent tracker monitoring architecture, currently used in the
Ubuntu Torrent Experiment\footnote{http://torrent.cs.pub.ro/} experiment at
University Politehnica of Bucharest, the Computer Science and Engineering
Department. The system analyses the peer-to-peer network considering both the
statistic data variation and the geographical distribution of data. This study
is based on a similar infrastructure with the one we use for our client and
protocol level analysis.

% video

Peer-to-Peer systems have ignited the interest of scientific and commercial
entities alike, with focus on improving performance, increasing the number of
users, market possible solutions, deploy and distribute content. As
video-based traffic has continuously filled the Internet backbone, effort has
been invested in providing streaming functionality to Peer-to-Peer solutions.
As Peer-to-Peer file sharing solutions use the ``offline playback'' model,
protocol and overlay network topology updates had to be considered.

Guo~el~al.~\cite{p2p-streaming-survey} have put up a survey of available P2P
streaming solutions in late 2007. They created a state of the art of streaming
solutions and took into consideration two basic overlay topologies: tree-based
systems and mesh-based systems (similar to swarm). For each of them they
surveyed existing Peer-to-Peer solutions for VoD and for live streaming. They
concluded that P2P streaming systems are capable of streaming video to a large
population at low server cost and with minimal dedicated infrastructure.
However, they signaled fundamental limitations such as reduced Quality of
Experience and the non-ISP friendly status of P2P applications and.

An important paper that was referred to by Guo et.~al, when considering VoD on
mesh-based systems was ``BiToS: Enhancing BitTorrent for Supporting Streaming
Applications''. In the latter article, Vlavianos~et~al.~\cite{bitos}, propose
updates to the popular BitTorrent protocol to turn in into a VoD-friendly
protocol, which they refer to \textbf{view-as-you-download}. They acknowledge
the fact that BitTorrent is an adequate protocol for large data distribution
but lack support for basic streaming due to its ``rarest-piece-first'' piece
selection policy. Therefore, they split the pieces that need to be collected
into two sets: a high priority set and a remaining piece set. They attach a
probability to a given piece and conclude that an updated priority-enhanced
rarest piece first-based policy retains good performance specific to the
BitTorrent protocol and provides VoD streaming support, allowing the
construction of a \textbf{view-as-you-download} service.

Lessons from BiToS were used and enhanced in ``Give-to-Get'', an updated form
of ``tit-for-tat'' within BitTorrent developed at TUDelft by
Mol~et~al.~\cite{give-to-get}. Give-to-Get assumes altruistic behavior for
peers -- that is it will voluntarily give out pieces to a peer in hope that
peer will be reciprocal. Give-to-Get takes into account that a peer's good
history is mostly irrelevant as a peer is concerned with data that needs to be
played out ``now''; peer ranking is built up accordingly. The solution using
Give-to-Get makes to important updates to BitTorrent: the neighbor selection
policy and the piece selection policy. Give-to-Get borrows heavily from BiToS,
and uses priority sets for altering the piece selection policy. Unlike BiToS,
however, Give-to-Get uses three sets: a high priority set, a medium priority
set and low-priority set. Give-to-Get had been designed with fairness in mind
and the issue of free riding is addressed heavily in the paper.

Mol~et.~al~\cite{design-p2p-live} had also worked on creating a live streaming
update to BitTorrent, as described in his technical paper ``The Design and
Deployment of a BitTorrent Live Video Streaming Solution''. As with
Give-to-Get, their solution was a mesh/swarm-based one and requested important
updates to the non-sequential BitTorrent protocol. A ``.tstream'' file had
been generated to describe content that, being live stream, had no
pre-determined length. A sliding window had been added for each peer, such
that information prior and before and certain point would be requested. The
initial seeder, also dubbed injector, provides the stream to other peers that
may, in turn, provide it to others. Dealing with the constraints and specifics
of a live streaming network, a seeder is redefined to being a peer which is
always trusted an unchoked by the injector and thus has access to the whole
stream. Seeders are required to ensure stability of the stream.

The latter two approaches (designed and implemented by
Mol~et.~al~\cite{give-to-get}~\cite{design-p2p-live}) form the basis for the
NextShare P2P streaming solution.

\todo{swift}

\section{Context}
\label{sec:intro:context}

The context of this work is defined by several key components, ranging from
the EU FP7 P2P-Next project to protocols such as BitTorrent or swift, from
the streaming updates and LivingLab used for trials to approaches such as
virtualization and logging information that formed the basis for the
infrastructure used as experimental setup.

The EU FP7 P2P-Next project\footnote{TODO} is the major component in the
context of this work. Much of the effort and results in the presented work
have been part of the P2P-Next project. The project has stated an ambitious
goal of ``providing the next generation content delivery platform''. With high
ranked commercial and accademic partners in Europe, it incorporates P2P
technology to provide streaming (both Video-on-Demand and live streaming) for
PC and for CE such as set-top boxes. Technology used by the P2P-Next project
is dubbed NextShare technology.

The BitTorrent protocol may be considered the flagship of nowdays P2P file
sharing networks. A highly successful and performant protocol, BitTorrent
stands at the basis of the NextShare core of the P2P-Next project.
BitTorrent's success story has spawned a wild number of implementations
leading to our analysis of its innerworkings for a variety of applications and
topologies. The BitTorrent protocol is easily identified by the two core
algorithms used for sharing content: \textit{tit-for-tat} for fair piece
exchange and \textit{rarest-piece-first} for the piece picking policy.

swift is a radical new approach to content distribution as peer-to-peer. It
discards many of the non-useful characteristics of TCP and proposes a
Transport layer protocol (in the OSI stack) that would be able to
intrinsically communicate with peers. It would not follow the usual end-to-end
approach as other Transport layer protocols, but rather create a
``multiparty'' approach where a request is simultaneously sent to multiple
peers. Facilities such as in order delivery or reliability are discarded,
making swift act as as ``BitTorrent protocol at Transport layer''.

\todo{P2P-Next, BitTorrent, swift,
multiparty, LivingLab, streaming, virtualization, logging}

\section{Contents}
\label{sec:intro:contents}

\todo{present chapters}
